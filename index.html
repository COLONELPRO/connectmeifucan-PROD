<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ContrÃ´les Globaux - DÃ©mo SimplifiÃ©e</title>
<style>
/* ========================= */
/* VARIABLES GLOBALES        */
/* ========================= */
:root {
  --bg1:#0d0d0d;
  --bg2:#1c1c1c;
  --text:#fff;
  --muted:#aaa;
  --accent:#ffcc00;
  --accent-hover:#ffaa00;
  --border:#444;
  --mobile: 768px; 
  --tablet: 1024px; 
  --desktop: 1440px;
}

/* ========================= */
/* RESET                     */
/* ========================= */
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }

body {
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(135deg, var(--bg1), var(--bg2));
  color: var(--text);
  display: flex;
  flex-direction: column;
  min-height: 100dvh;
}

/* ========================= */
/* SPLASH SCREEN             */
/* ========================= */
#splash {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at top, var(--accent), var(--bg1));
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: #000;
  z-index: 9999;
  transition: transform 2s ease-in-out, opacity 1s ease-in-out;
  overflow: hidden;
}
#splash.hidden { opacity: 0; pointer-events: none; }
#splash.zooming { transform: scale(1.5); opacity: 0; transition: transform .9s ease, opacity .9s ease; pointer-events: none; }

/* VIDEO BACKGROUND */
#splash-video {
  position: absolute;
  top: 50%;
  left: 50%;
  min-width: 100%;
  min-height: 100%;
  width: auto;
  height: auto;
  transform: translate(-50%, -50%);
  object-fit: cover;
  z-index: 1;
  opacity: 1;
  will-change: auto;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* OVERLAY POUR LISIBILITÃ‰ */
#splash-overlay {
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at top, rgba(255,204,0,0.2), rgba(13,13,13,0.5));
  z-index: 2;
  pointer-events: none;
}

/* CONTENU AU-DESSUS DE LA VIDÃ‰O */
#splash > h1 {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -40% );
  z-index: 3;
  text-align: center;
  transition: opacity .3s ease, transform .3s ease;
}

#splash > p {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, calc(-50% + 50px));
  z-index: 3;
  text-align: center;
  transition: opacity .3s ease, transform .3s ease;
  font-size: 1.2rem;
  max-width: 80%;
}

/* ========================= */
/* SPLASH: ENTER SIDES + PROGRESS */
/* ========================= */
.top-container {
  position: fixed;
  left: 0;
  right: 0;
  top: 0;
  display: block;
  padding: 0 24px;
  width: 100%;
  pointer-events: none;
  background: #000;
  height: 120px;
  z-index: 10000;
}

.enter-sides {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  display: block;
  padding: 0 24px;
  width: 100%;
  pointer-events: none;
  background: #000;
  height: 120px;
  z-index: 10000;
}

.enter-sides {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  display: block;
  padding: 0 24px;
  width: 100%;
  pointer-events: none;
  background: #000;
  height: 120px;
  z-index: 10000;
}
.enter-sides .enter-side {
  pointer-events: auto;
}
.enter-side {
  position: absolute;
  bottom: 50%;
  width: 64px;
  height: 64px;
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 1.6rem;
  background: var(--accent);
  color: #000;
  border: 3px solid rgba(0,0,0,0.12);
  cursor: pointer;
  transform: translateY(calc(-50% + var(--enter-ty, 0)));
  transition: transform .12s ease, box-shadow .12s ease, opacity .3s ease;
  user-select: none;
  touch-action: none;
}
#enter-left { left: 24px; }
#enter-right { right: 24px; }
.enter-side.pressing { 
  transform: translateY(calc(-50% + var(--enter-ty, 0))) scale(.94); 
  box-shadow: 0 10px 28px rgba(0,0,0,.35); 
}

.enter-side .enter-label {
  display: inline-block;
  font-size: 0.72rem;
  font-weight: normal;
  line-height: 1;
  text-align: center;
  padding: 6px 6px;
  color: #000;
}

#press-progress-bar {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 54%;
  max-width: 640px;
  height: 14px;
  background: rgba(255,255,255,0.12);
  border-radius: 10px;
  overflow: hidden;
  display: none;
  align-items: center;
  z-index: 1;
  opacity: 0.97;
}
#press-progress-bar.visible { display: flex; }
#press-progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--accent), var(--accent-hover));
  transition: none;
  will-change: width;
}
#press-progress-text {
  position: absolute;
  right: 8px;
  font-weight: 800;
  color: #000;
  font-size: 0.85rem;
}

/* ========================= */
/* GLOBAL CONTROL (persistent) */
/* ========================= */
.global { 
  position: fixed !important; 
  bottom: 18%; 
  z-index: 10001; 
  display: none; 
  align-items: center; 
  justify-content: center; 
  width:64px; 
  height:64px; 
  transform: none !important; 
  pointer-events: auto; 
  transition: opacity .18s ease, transform .18s ease; 
}
.global.show { display: inline-flex; }
body.hand-left .global { left: 18px; right: auto; }

body.hand-right .global { right: 18px; left: auto; }
body.hand-left .global.back { right: 18px; left: auto; }
body.hand-right .global.back { left: 18px; right: auto; }
body.hand-left #enter-right, 
body.hand-right #enter-left { 
  display: none !important; 
}
.global.auto-hidden { 
  opacity: 0; 
  transform: translateY(8px) scale(.98); 
  pointer-events: none; 
}
.global.show.auto-hidden { display: inline-flex; }

/* ========================= */
/* PAGES                     */
/* ========================= */
.page {
  display: none;
  opacity: 0;
  transition: transform .9s ease, opacity .6s ease;
  transform: scale(0.7);
  pointer-events: none;
  padding: 24px;
  text-align: center;
}

.page.frame {
  background: radial-gradient(circle at top, rgba(255,204,0,0.06), rgba(0,0,0,0.02) 40%);
  border-radius: 12px;
  width: calc(100% - 48px);
  max-width: 1200px;
  box-shadow: 0 8px 40px rgba(0,0,0,0.45);
  margin: 0 auto;
  padding: 18px 24px;
}

.page.active {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: calc(100dvh - 0px);
  opacity: 1;
  pointer-events: auto;
  transform: scale(1);
  text-align: center;
}

.page.scale-in {
  transform: scale(1);
  opacity: 1;
}

.page.zooming {
  transform: scale(1.12);
  opacity: 0;
  transition: transform .7s ease, opacity .7s ease;
  pointer-events: none;
}

.page h2 {
  font-size: 2rem;
  margin-bottom: 10px;
}

.page p {
  font-size: 1.1rem;
  color: var(--muted);
}

/* Mobile adjustments */
@media (max-width: calc(var(--mobile) - 1px)) {
  .top-container { background: transparent; }
  .enter-sides { bottom: 6%; padding: 0 6%; background: transparent; }
  #enter-left { left: 6%; }
  #enter-right { right: 6%; }
  .global { bottom: 6%; }
  body.hand-left .global { left: 6%; }
  body.hand-right .global { right: 6%; }
  body.hand-left .global.back { right: 6%; }
  body.hand-right .global.back { left: 6%; }
  .enter-side { width: 56px; height: 56px; font-size: 1.4rem; }
  
  body.page-open .enter-sides { bottom: 28%; padding: 0 24%; }
  body.page-open .global { bottom: 28%; }
  body.hand-left.page-open .global { left: 24px; right: auto; }
  body.hand-right.page-open .global { right: 24px; left: auto; }
  body.hand-left.page-open .global.back { right: 24px; left: auto; }
  body.hand-right.page-open .global.back { left: 24px; right: auto; }
  body.page-open .enter-side { width: 64px; height: 64px; font-size: 1.6rem; }
}

/* ========================= */
/* BOUTONS NAVIGATION PAGES  */
/* ========================= */
.nav-buttons {
  margin-top: 40px;
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  justify-content: center;
}

.nav-btn {
  padding: 12px 24px;
  background: var(--accent);
  color: #000;
  font-weight: bold;
  border-radius: 8px;
  cursor: pointer;
  border: 1px solid var(--border);
  transition: transform .2s ease, background .2s ease;
  text-decoration: none;
  display: inline-block;
}

.nav-btn:hover {
  background: var(--accent-hover);
  transform: translateY(-2px) scale(1.05);
}

/* ========================= */
/* MENU (pas de widget ici)  */
/* ========================= */
#menu {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px;
  transform: scale(0.7);
  transition: transform .9s ease, opacity .6s ease;
  opacity: 0;
  z-index: 9000;
  pointer-events: none;
}

#menu.active {
  opacity: 1;
  pointer-events: auto;
  transform: scale(1);
}

.menu-title {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 8px;
  text-align: center;
}

.menu-subtitle {
  font-size: 1.1rem;
  color: var(--muted);
  margin-bottom: 32px;
  text-align: center;
}

.menu-widgets {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 24px;
  width: 100%;
  max-width: 1000px;
  padding: 0;
}

.menu-widget {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 32px 24px;
  background: linear-gradient(135deg, rgba(255,204,0,0.08), rgba(255,204,0,0.02));
  border: 2px solid rgba(255,204,0,0.2);
  border-radius: 16px;
  cursor: pointer;
  transition: all .3s ease;
  text-align: center;
  min-height: 200px;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.menu-widget::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at center, rgba(255,204,0,0.15), transparent);
  opacity: 0;
  transition: opacity .3s ease;
}

.menu-widget:hover::before {
  opacity: 1;
}

.menu-widget:hover {
  transform: translateY(-8px) scale(1.02);
  border-color: var(--accent);
  box-shadow: 0 12px 32px rgba(255,204,0,0.3), 0 0 40px rgba(255,204,0,0.1);
}

.menu-widget-icon {
  font-size: 3.5rem;
  margin-bottom: 16px;
  filter: drop-shadow(0 2px 8px rgba(255,204,0,0.3));
}

.menu-widget-title {
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 8px;
}

.menu-widget-desc {
  font-size: 0.9rem;
  color: var(--muted);
  line-height: 1.4;
}

/* Mobile adjustments - Widgets verticaux optimisÃ©s */
@media (max-width: calc(var(--mobile) - 1px)) {
  #menu {
    padding: 16px;
    justify-content: flex-start;
    padding-top: 80px;
  }
  
  .menu-title {
    font-size: 1.6rem;
    margin-bottom: 6px;
  }
  
  .menu-subtitle {
    font-size: 0.9rem;
    margin-bottom: 24px;
  }
  
  .menu-widgets {
    grid-template-columns: 1fr;
    gap: 12px;
    max-width: 100%;
    padding: 0 8px;
  }
  
  .menu-widget {
    min-height: auto;
    padding: 20px 16px;
    border-radius: 12px;
    flex-direction: column;
    gap: 8px;
  }
  
  .menu-widget-icon {
    font-size: 2.5rem;
    margin-bottom: 8px;
  }
  
  .menu-widget-title {
    font-size: 1.05rem;
    margin-bottom: 4px;
  }
  
  .menu-widget-desc {
    font-size: 0.85rem;
    line-height: 1.3;
  }
  
  .menu-widget:hover {
    transform: translateY(-4px) scale(1.01);
  }
}

/* TrÃ¨s petits Ã©crans - widgets encore plus compacts */
@media (max-width: 480px) {
  #menu {
    padding: 12px;
    padding-top: 60px;
  }
  
  .menu-title {
    font-size: 1.4rem;
  }
  
  .menu-subtitle {
    font-size: 0.85rem;
    margin-bottom: 20px;
  }
  
  .menu-widgets {
    gap: 10px;
    padding: 0 4px;
  }
  
  .menu-widget {
    padding: 18px 14px;
    border-radius: 10px;
  }
  
  .menu-widget-icon {
    font-size: 2.2rem;
    margin-bottom: 6px;
  }
  
  .menu-widget-title {
    font-size: 1rem;
  }
  
  .menu-widget-desc {
    font-size: 0.8rem;
  }
}
</style>
</head>

<body>

<!-- ========================= -->
<!-- SPLASH SCREEN             -->
<!-- ========================= -->
<div id="splash">
  <!-- VIDEO BACKGROUND SYNCHRONISÃ‰E -->
  <video id="splash-video" muted playsinline preload="auto">
    <source src="TEST_MP4.mp4" type="video/mp4">
  </video>
  
  <!-- OVERLAY POUR AMÃ‰LIORER LA LISIBILITÃ‰ -->
  <div id="splash-overlay"></div>
  
  <h1>Bienvenue</h1>
  <p>Appuyer sur un bouton pour entrer</p>

  <div class="top-container">
  </div>

  <div class="enter-sides">
    <div id="press-progress-bar" aria-hidden="true">
      <div id="press-progress-fill"></div>
      <div id="press-progress-text">0%</div>
    </div>
    <button id="enter-left" class="enter-side" aria-label="Entrer - main gauche" title="Entrer â€” Main gauche">
      <span class="enter-label">Appuyer pour entrer</span>
    </button>
    <button id="enter-right" class="enter-side" aria-label="Entrer - main droite" title="Entrer â€” Main droite">
      <span class="enter-label">Appuyer pour entrer</span>
    </button>
  </div>
</div>

<!-- ========================= -->
<!-- MENU AVEC WIDGETS         -->
<!-- ========================= -->
<div id="menu">
  <div class="menu-title">Choisissez une catÃ©gorie</div>
  <div class="menu-subtitle">SÃ©lectionnez votre expÃ©rience</div>

  <div class="menu-widgets">
    <button class="menu-widget" data-nav="page1">
      <div class="menu-widget-icon">ðŸŒ¿</div>
      <div class="menu-widget-title">Comfort & Well-Being</div>
      <div class="menu-widget-desc">Create your perfect home environment</div>
    </button>
    
    <button class="menu-widget" data-nav="page2">
      <div class="menu-widget-icon">ðŸŽ¨</div>
      <div class="menu-widget-title">Drawing Chain Game</div>
      <div class="menu-widget-desc">Collaborative creative experience</div>
    </button>
    
    <button class="menu-widget" data-nav="page3">
      <div class="menu-widget-icon">ðŸŒŒ</div>
      <div class="menu-widget-title">New Realities</div>
      <div class="menu-widget-desc">Explore immersive connections</div>
    </button>
  </div>
</div>

<!-- ========================= -->
<!-- CONTRÃ”LES GLOBAUX         -->
<!-- ========================= -->
<button id="global-control" class="enter-side global" aria-hidden="true">
  <span class="enter-label">Pages</span>
</button>
<button id="global-back" class="enter-side global back" aria-hidden="true">
  <span class="enter-label">Retour</span>
</button>

<!-- ========================= -->
<!-- PAGE 1 (VIDE)             -->
<!-- ========================= -->
<div id="page1" class="page">
  <h2>ðŸ“„ Page 1</h2>
  <p>Contenu de la page 1</p>
  
  <div class="nav-buttons">
    <button class="nav-btn" data-nav="page2">â†’ Page 2</button>
    <button class="nav-btn" data-nav="page3">â†’ Page 3</button>
  </div>
</div>

<!-- ========================= -->
<!-- PAGE 2 (VIDE)             -->
<!-- ========================= -->
<div id="page2" class="page">
  <h2>ðŸ“„ Page 2</h2>
  <p>Contenu de la page 2</p>
  
  <div class="nav-buttons">
    <button class="nav-btn" data-nav="page1">â†’ Page 1</button>
    <button class="nav-btn" data-nav="page3">â†’ Page 3</button>
  </div>
</div>

<!-- ========================= -->
<!-- PAGE 3 (VIDE)             -->
<!-- ========================= -->
<div id="page3" class="page">
  <h2>ðŸ“„ Page 3</h2>
  <p>Contenu de la page 3</p>
  
  <div class="nav-buttons">
    <button class="nav-btn" data-nav="page1">â†’ Page 1</button>
    <button class="nav-btn" data-nav="page2">â†’ Page 2</button>
  </div>
</div>

<!-- ========================= -->
<!-- SCRIPT                    -->
<!-- ========================= -->
<script>
console.debug('Script loaded');

// ========================= 
// TRANSLATIONS / TRADUCTIONS
// =========================
const translations = {
  fr: {
    // Splash screen
    splash_title: "Bienvenue",
    splash_subtitle: "Vivez une nouvelle expÃ©rience chaque jour depuis chez vous, dÃ¨s maintenant",
    enter_label: "Appuyer pour entrer",
    progress_wait: "Patienter",
    
    // Menu
    menu_title: "Choisissez une catÃ©gorie",
    menu_subtitle: "SÃ©lectionnez votre expÃ©rience",
    
    // Widgets
    widget1_title: "Confort & Bien-Ãªtre",
    widget1_desc: "CrÃ©ez votre environnement domestique parfait",
    widget2_title: "Jeu du Dessin en ChaÃ®ne",
    widget2_desc: "ExpÃ©rience crÃ©ative collaborative",
    widget3_title: "Nouvelles RÃ©alitÃ©s",
    widget3_desc: "Explorez les connexions immersives",
    
    // Controls
    control_pages: "Pages",
    control_back: "Retour",
    
    // Pages
    page_title: "Page",
    page_content: "Contenu de la page"
  },
  en: {
    // Splash screen
    splash_title: "Welcome",
    splash_subtitle: "Live a new experience every day from home",
    enter_label: "Press to enter",
    progress_wait: "Wait",
    
    // Menu
    menu_title: "Choose a category",
    menu_subtitle: "Select your experience",
    
    // Widgets
    widget1_title: "Comfort & Well-Being",
    widget1_desc: "Create your perfect home environment",
    widget2_title: "Drawing Chain Game",
    widget2_desc: "Collaborative creative experience",
    widget3_title: "New Realities",
    widget3_desc: "Explore immersive connections",
    
    // Controls
    control_pages: "Pages",
    control_back: "Back",
    
    // Pages
    page_title: "Page",
    page_content: "Page content"
  }
};

// Detect browser language
const browserLang = navigator.language || navigator.userLanguage;
const currentLang = browserLang.startsWith('fr') ? 'fr' : 'en';

// Translation function
function t(key) {
  return translations[currentLang][key] || translations['en'][key] || key;
}

console.debug('Language detected:', currentLang);

const splash = document.getElementById("splash");
const btnLeft = document.getElementById('enter-left');
const btnRight = document.getElementById('enter-right');
const progressBar = document.getElementById('press-progress-bar');
const progressFill = document.getElementById('press-progress-fill');
const progressText = document.getElementById('press-progress-text');
const globalControl = document.getElementById('global-control');
const globalBack = document.getElementById('global-back');

const PRESS_MS = 2000;
let pressRaf = null;
let pressStart = 0;
let currentHand = null;

// ========================= 
// PROGRESS BAR (CONTROLLED BY VIDEO)
// =========================
const splashVideo = document.getElementById('splash-video');

function updateProgressUI(percent) {
  if (progressFill) progressFill.style.width = percent + '%';
  if (progressText) progressText.textContent = t('progress_wait') + ' ' + Math.round(percent) + '%';
}

function resetProgress() {
  if (pressRaf) { cancelAnimationFrame(pressRaf); pressRaf = null; }
  if (progressBar) progressBar.classList.remove('visible');
  updateProgressUI(0);
  currentHand = null;
}

// ========================= 
// SPLASH â†’ PAGES
// =========================
function doComplete(hand) {
  console.debug('doComplete', hand);
  
  if (hand && hand !== 'auto') showGlobalControl(hand);
  
  if (splash) splash.classList.add('zooming');
  
  setTimeout(() => {
    if (splash && splash.parentNode) splash.remove();
    
    // Afficher le menu
    const menu = document.getElementById('menu');
    if (menu) {
      menu.classList.add('active');
    }
    
    resetProgress();
  }, 900);
}

// ========================= 
// SPLASH BUTTON HANDLERS
// =========================
[btnLeft, btnRight].forEach(btn => {
  if (!btn) return;
  const hand = btn.id === 'enter-left' ? 'left' : 'right';
  
  btn._videoTimeHandler = null;
  btn._videoEndedHandler = null;
  
  function localStartPress() {
    if (!progressBar || !splashVideo) return;
    currentHand = hand;
    progressBar.classList.add('visible');
    
    // Masquer les deux disques
    if (btnLeft) {
      btnLeft.style.opacity = '0';
      btnLeft.style.pointerEvents = 'none';
    }
    if (btnRight) {
      btnRight.style.opacity = '0';
      btnRight.style.pointerEvents = 'none';
    }
    
    // Masquer les titres et texte
    const splashTitle = splash.querySelector('h1');
    const splashText = splash.querySelector('p');
    if (splashTitle) {
      splashTitle.style.opacity = '0';
      splashTitle.style.transform = 'translateY(-10px)';
    }
    if (splashText) {
      splashText.style.opacity = '0';
      splashText.style.transform = 'translateY(-10px)';
    }
    
    // RÃ©initialiser la vidÃ©o au dÃ©but
    splashVideo.currentTime = 0;
    
    // Ã‰couter la progression de la vidÃ©o
    btn._videoTimeHandler = () => {
      if (splashVideo.duration) {
        const percent = (splashVideo.currentTime / splashVideo.duration) * 100;
        updateProgressUI(percent);
        
        // VÃ©rifier si on atteint 100%
        if (percent >= 99.5) {
          localComplete();
        }
      }
    };
    
    btn._videoEndedHandler = () => {
      localComplete();
    };
    
    splashVideo.addEventListener('timeupdate', btn._videoTimeHandler);
    splashVideo.addEventListener('ended', btn._videoEndedHandler);
    
    // DÃ©marrer la lecture
    splashVideo.play().catch(err => console.warn('Autoplay error:', err));
  }
  
  function localComplete() {
    if (btn._videoTimeHandler) {
      splashVideo.removeEventListener('timeupdate', btn._videoTimeHandler);
      btn._videoTimeHandler = null;
    }
    if (btn._videoEndedHandler) {
      splashVideo.removeEventListener('ended', btn._videoEndedHandler);
      btn._videoEndedHandler = null;
    }
    splashVideo.pause();
    doComplete(hand);
  }
  
  function localReset() {
    if (btn._videoTimeHandler) {
      splashVideo.removeEventListener('timeupdate', btn._videoTimeHandler);
      btn._videoTimeHandler = null;
    }
    if (btn._videoEndedHandler) {
      splashVideo.removeEventListener('ended', btn._videoEndedHandler);
      btn._videoEndedHandler = null;
    }
    splashVideo.pause();
    splashVideo.currentTime = 0;
    progressBar.classList.remove('visible');
    updateProgressUI(0);
    currentHand = null;
    
    // RÃ©afficher les deux disques
    if (btnLeft) {
      btnLeft.style.opacity = '1';
      btnLeft.style.pointerEvents = 'auto';
    }
    if (btnRight) {
      btnRight.style.opacity = '1';
      btnRight.style.pointerEvents = 'auto';
    }
    
    // RÃ©afficher les titres et texte
    const splashTitle = splash.querySelector('h1');
    const splashText = splash.querySelector('p');
    if (splashTitle) {
      splashTitle.style.opacity = '1';
      splashTitle.style.transform = 'translateY(0)';
    }
    if (splashText) {
      splashText.style.opacity = '1';
      splashText.style.transform = 'translateY(0)';
    }
  }
  
  btn.addEventListener('pointerdown', e => {
    e.preventDefault();
    try { btn.setPointerCapture && btn.setPointerCapture(e.pointerId); } catch (err) {}
    btn.classList.add('pressing');
    localStartPress();
  });
  
  btn.addEventListener('pointerup', e => {
    try { btn.releasePointerCapture && btn.releasePointerCapture(e.pointerId); } catch (err) {}
    btn.classList.remove('pressing');
    if (btn._pressRaf) localReset();
  });
  
  btn.addEventListener('pointercancel', e => { 
    btn.classList.remove('pressing'); 
    localReset(); 
  });
  
  btn.addEventListener('pointerleave', e => { 
    if (btn._pressRaf) localReset(); 
    btn.classList.remove('pressing'); 
  });
});

// ========================= 
// GLOBAL CONTROLS
// =========================
function showGlobalControl(hand) {
  if (!globalControl) return;
  document.body.dataset.hand = hand;
  localStorage.setItem('cmuc_hand', hand);
  document.body.classList.remove('hand-left','hand-right');
  document.body.classList.add('hand-' + hand);
  globalControl.style.display = 'inline-flex';
  globalControl.classList.add('show');
  globalControl.setAttribute('aria-hidden', 'false');
}

function updateGlobalVisibility() {
  const pageActive = !!document.querySelector('.page.active');
  
  if (globalControl) {
    if (pageActive) { 
      globalControl.style.display = 'inline-flex'; 
      globalControl.classList.add('show'); 
      globalControl.setAttribute('aria-hidden', 'false'); 
    }
    else { 
      globalControl.style.display = 'none'; 
      globalControl.classList.remove('show'); 
      globalControl.setAttribute('aria-hidden', 'true'); 
    }
  }
  
  if (globalBack) {
    if (pageActive) { 
      globalBack.style.display = 'inline-flex'; 
      globalBack.classList.add('show'); 
      globalBack.setAttribute('aria-hidden', 'false'); 
    }
    else { 
      globalBack.style.display = 'none'; 
      globalBack.classList.remove('show'); 
      globalBack.setAttribute('aria-hidden', 'true'); 
    }
  }
}

// ========================= 
// AUTO-HIDE CONTROLS
// =========================
let hideControlsTimer = null;

function scheduleAutoHideControls(delay = 1000) {
  clearTimeout(hideControlsTimer);
  hideControlsTimer = setTimeout(() => {
    if (document.querySelector('.page.active')) {
      globalControl && globalControl.classList.add('auto-hidden');
      globalBack && globalBack.classList.add('auto-hidden');
    }
  }, delay);
}

function cancelAutoHideControls() {
  clearTimeout(hideControlsTimer);
  hideControlsTimer = null;
}

function showControlsOnTouch() {
  if (!document.querySelector('.page.active')) return;
  globalControl && globalControl.classList.remove('auto-hidden');
  globalBack && globalBack.classList.remove('auto-hidden');
  cancelAutoHideControls();
  scheduleAutoHideControls(1000);
}

document.addEventListener('pointerdown', (e) => {
  if (e.pointerType === 'touch' || e.pointerType === 'mouse') showControlsOnTouch();
});

document.addEventListener('pointermove', (e) => {
  if (e.pointerType === 'mouse') showControlsOnTouch();
}, { passive: true });

// ========================= 
// PAGE NAVIGATION
// =========================
function navigateToPage(target) {
  const page = document.getElementById(target);
  if (!page) return;
  
  document.body.classList.add('page-open');
  
  document.querySelectorAll('.page').forEach(p => { 
    if (p !== page) { 
      p.classList.remove('active','scale-in','frame','zooming'); 
    } 
  });
  
  page.classList.add('frame');
  page.classList.add('active');
  
  setTimeout(() => {
    page.classList.add('scale-in');
    updateGlobalVisibility();
    scheduleAutoHideControls(1000);
  }, 20);
}

function goBackToSplash() {
  const activePage = document.querySelector('.page.active');
  const menu = document.getElementById('menu');
  
  if (activePage) {
    activePage.classList.add('zooming');
    setTimeout(() => {
      activePage.classList.remove('active','scale-in','frame','zooming');
      cancelAutoHideControls();
      globalControl && globalControl.classList.remove('auto-hidden');
      globalBack && globalBack.classList.remove('auto-hidden');
      document.body.classList.remove('page-open');
      
      // Hide global controls
      if (globalControl) {
        globalControl.style.display = 'none';
        globalControl.classList.remove('show');
      }
      if (globalBack) {
        globalBack.style.display = 'none';
        globalBack.classList.remove('show');
      }
      
      // Afficher le menu au lieu de recrÃ©er le splash
      if (menu) {
        menu.classList.add('active');
      }
      
      updateGlobalVisibility();
    }, 700);
  } else if (menu && menu.classList.contains('active')) {
    // Si on est sur le menu, recharger la page pour revenir au splash
    document.body.classList.remove('hand-left', 'hand-right');
    delete document.body.dataset.hand;
    localStorage.removeItem('cmuc_hand');
    location.reload();
  }
}

// ========================= 
// BUTTON HANDLERS
// =========================
if (globalBack) {
  globalBack.addEventListener('click', e => {
    e.preventDefault();
    goBackToSplash();
  });
}

// Navigation buttons
document.querySelectorAll('.nav-btn[data-nav]').forEach(btn => {
  btn.addEventListener('click', () => {
    const target = btn.dataset.nav;
    navigateToPage(target);
  });
});

// Menu widgets
document.querySelectorAll('.menu-widget[data-nav]').forEach(widget => {
  widget.addEventListener('click', () => {
    const target = widget.dataset.nav;
    const menu = document.getElementById('menu');
    if (menu) {
      menu.classList.remove('active');
    }
    navigateToPage(target);
  });
});

// Initialize from storage if needed
const storedHand = localStorage.getItem('cmuc_hand');
if (storedHand === 'left' || storedHand === 'right') {
  console.debug('Stored hand found:', storedHand);
}

console.debug('All handlers initialized');

// ========================= 
// APPLY TRANSLATIONS TO DOM
// =========================
function applyTranslations() {
  // Splash screen
  const splashTitle = splash?.querySelector('h1');
  const splashSubtitle = splash?.querySelector('p');
  if (splashTitle) splashTitle.textContent = t('splash_title');
  if (splashSubtitle) splashSubtitle.textContent = t('splash_subtitle');
  
  // Enter buttons
  document.querySelectorAll('.enter-label').forEach(label => {
    if (label.closest('#enter-left') || label.closest('#enter-right')) {
      label.textContent = t('enter_label');
    }
  });
  
  // Menu
  const menuTitle = document.querySelector('.menu-title');
  const menuSubtitle = document.querySelector('.menu-subtitle');
  if (menuTitle) menuTitle.textContent = t('menu_title');
  if (menuSubtitle) menuSubtitle.textContent = t('menu_subtitle');
  
  // Widgets
  const widgets = document.querySelectorAll('.menu-widget');
  if (widgets[0]) {
    widgets[0].querySelector('.menu-widget-title').textContent = t('widget1_title');
    widgets[0].querySelector('.menu-widget-desc').textContent = t('widget1_desc');
  }
  if (widgets[1]) {
    widgets[1].querySelector('.menu-widget-title').textContent = t('widget2_title');
    widgets[1].querySelector('.menu-widget-desc').textContent = t('widget2_desc');
  }
  if (widgets[2]) {
    widgets[2].querySelector('.menu-widget-title').textContent = t('widget3_title');
    widgets[2].querySelector('.menu-widget-desc').textContent = t('widget3_desc');
  }
  
  // Global controls
  const globalControlLabel = globalControl?.querySelector('.enter-label');
  const globalBackLabel = globalBack?.querySelector('.enter-label');
  if (globalControlLabel) globalControlLabel.textContent = t('control_pages');
  if (globalBackLabel) globalBackLabel.textContent = t('control_back');
  
  // Pages
  document.querySelectorAll('.page').forEach((page, index) => {
    const pageNum = index + 1;
    const h2 = page.querySelector('h2');
    const p = page.querySelector('p');
    if (h2) h2.textContent = `ðŸ“„ ${t('page_title')} ${pageNum}`;
    if (p) p.textContent = `${t('page_content')} ${pageNum}`;
  });
}

// Apply translations on page load
applyTranslations();
</script>

</body>
</html>
