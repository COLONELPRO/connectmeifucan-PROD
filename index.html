<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<!-- <title>Site avec Splash + Menu + Pages</title> -->
<title>Exp√©rience Immersive</title>
<style>
/* ========================= */
/* VARIABLES GLOBALES        */
/* ========================= */
:root {
  --bg1:#0d0d0d;
  --bg2:#1c1c1c;
  --text:#fff;
  --muted:#aaa;
  --accent:#ffcc00;
  --accent-hover:#ffaa00;
  --border:#444;
  --mobile: 768px; 
  --tablet: 1024px; 
  --desktop: 1440px;
}

/* ========================= */
/* RESET                     */
/* ========================= */
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }

body {
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(135deg, var(--bg1), var(--bg2));
  color: var(--text);
  display: flex;
  flex-direction: column;
  min-height: 100dvh;
}

/* ========================= */
/* SPLASH SCREEN             */
/* ========================= */
#splash {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at top, var(--accent), var(--bg1));
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: #000;
  z-index: 9999;
 transition: transform 2s ease-in-out, opacity 1s ease-in-out;
}
#splash.hidden { opacity: 0; pointer-events: none; }

/* ========================= */
/* SPLASH: ENTER SIDES + PROGRESS */
/* ========================= */
.enter-sides {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 28%;
  /* keep as a positioning container for absolute buttons */
  display: block;
  padding: 0 24px;
  width: 100%;
  max-width: 1200px;
  pointer-events: none; /* children manage pointer-events */
}
.enter-sides .enter-side {
  pointer-events: auto;
}
.enter-side {
  position: absolute; /* place each button explicitly */
  top: 50%;
  left: auto;
  right: auto;
  width: 64px;
  height: 64px;
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 1.6rem;
  background: var(--accent);
  color: #000;
  border: 3px solid rgba(0,0,0,0.12);
  cursor: pointer;
  /* vertically center while preserving any manual snap via --enter-ty */
  transform: translateY(calc(-50% + var(--enter-ty, 0)));
  transition: transform .12s ease, box-shadow .12s ease;
  user-select: none;
  touch-action: none; /* avoid double-tap/context issues on touch */
}
/* fixed horizontal offsets for symmetry */
#enter-left { left: 24px; }
#enter-right { right: 24px; }
/* keep pressing transform while preserving translate */
.enter-side.pressing { transform: translateY(calc(-50% + var(--enter-ty, 0))) scale(.94); box-shadow: 0 10px 28px rgba(0,0,0,.35); }
.enter-side.pressing { transform: translateY(var(--enter-ty, 0)) scale(.94); box-shadow: 0 10px 28px rgba(0,0,0,.35); }

.enter-side .enter-label {
  display: inline-block;
  font-size: 0.72rem;
  font-weight: normal;
  line-height: 1;
  text-align: center;
  padding: 6px 6px;
  color: #000;
}
.enter-side.pressing .enter-label { filter: brightness(.95); }
.enter-side.pressing { transform: scale(.94); box-shadow: 0 10px 28px rgba(0,0,0,.35); }

#press-progress-bar {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: 40%;
  width: 60%;
  max-width: 640px;
  height: 14px;
  background: rgba(255,255,255,0.12);
  border-radius: 10px;
  overflow: hidden;
  display: none;
  align-items: center;
}
#press-progress-bar.visible { display: flex; }
#press-progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--accent), var(--accent-hover));
  transition: width .05s linear;
}
#press-progress-text {
  position: absolute;
  right: 8px;
  font-weight: 800;
  color: #000;
  font-size: 0.85rem;
}

/* ZOOM TRANSITION TO MENU */
#splash.zooming { transform: scale(1.12); opacity: 0; transition: transform .7s ease, opacity .7s ease; pointer-events: none; }
#menu { transform: scale(.98); transition: transform .7s ease, opacity .4s ease; opacity: 0; }
#menu.active.scale-in { transform: scale(1); opacity: 1; }

/* GLOBAL CONTROL (persistent) */
.global { position: fixed !important; bottom: 18%; z-index: 10001; display: none; align-items: center; justify-content: center; width:64px; height:64px; transform: none !important; pointer-events: auto; }
.global.show { display: inline-flex; }
body.hand-left .global { left: 18px; right: auto; }
body.hand-right .global { right: 18px; left: auto; }
/* Back control positions - opposite side of the chosen hand */
body.hand-left .global.back { right: 18px; left: auto; }
body.hand-right .global.back { left: 18px; right: auto; }
/* Hide the other splash disc if a hand is selected */
body.hand-left #enter-right, body.hand-right #enter-left { display: none !important; }

/* menu selection style */
.menu-btn.selected { box-shadow: 0 8px 24px rgba(0,0,0,0.35); transform: translateY(-2px) scale(1.02); border: 2px solid rgba(255,204,0,0.95); }
.menu-btn:focus { outline: none; }

/* ========================= */
/* BOUTONS LANGUE            */
/* ========================= */
.lang-switch {
  position: fixed;
  top: 12px;
  right: 12px;
  display: flex;
  gap: 8px;
  z-index: 10000;
}

.lang-btn {
  padding: 6px 12px;
  background: var(--accent);
  color: #000;
  font-weight: bold;
  border-radius: 6px;
  cursor: pointer;
  border: 1px solid var(--border);
  transition: transform .2s ease, background .2s ease;
}
.lang-btn:hover {
  background: var(--accent-hover);
  transform: scale(1.05);
}

/* ========================= */
/* ECRAN INTERMEDIAIRE       */
/* ========================= */

/* üì± Mobile : 0 ‚Üí 767px */
@media (max-width: calc(var(--mobile) - 1px)) {
    #menu {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;   /* centr√© */
        gap: 18px;
        text-align: center;
        z-index: 9000;
    }
}

/* üì≤ Tablette : 768px ‚Üí 1023px */
@media (min-width: var(--mobile)) and (max-width: calc(var(--tablet) - 1px)) {
    #menu {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;   /* centr√© */
        gap: 18px;
        text-align: center;
    }
}

/* üíª Desktop : 1024px ‚Üí ‚àû */
@media (min-width: var(--tablet)) {
    #menu {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;   /* centered like mobile */
        gap: 18px;
        text-align: center;
        z-index: 9000;
        position: static;
        padding-left: 0; /* remove left offset so buttons are centered */
    }
}
/*
#menu.active { display: flex; }
*/
.menu-title {
  font-size: 2rem;
  font-weight: bold;
}
.menu-subtitle {
  font-size: 1.1rem;
  color: var(--muted);
  margin-bottom: 20px;
}

/* ========================= */
/* BOUTONS CATEGORIES        */
/* ========================= */
.menu-btn {
  width: 260px; /* largeur uniforme */ 
  text-align: center; /* centre le texte */
  padding: 14px 32px;
  background: var(--accent);
  color: #000;
  font-weight: 700;
  border-radius: 10px;
  text-decoration: none;
  cursor: pointer;
  transition: transform .2s ease, background .2s ease;
}
.menu-btn:hover {
  background: var(--accent-hover);
  transform: translateY(-2px) scale(1.05);
}

/* ========================= */
/* PAGES PRINCIPALES         */
/* ========================= */
.page {
  display: none;
  opacity: 0;
  transition: transform .7s ease, opacity .4s ease;
  transform: scale(.98);
  pointer-events: none;
  padding: 24px;
  text-align: center;
}

/* page frame: subtle radial highlight + box to mimic splash background */
.page.frame {
  background: radial-gradient(circle at top, rgba(255,204,0,0.06), rgba(0,0,0,0.02) 40%);
  border-radius: 12px;
  width: calc(100% - 48px);
  max-width: 1200px;
  box-shadow: 0 8px 40px rgba(0,0,0,0.45);
}

.page.active {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: calc(100dvh - 0px);
  opacity: 1;
  pointer-events: auto;
  transform: scale(1);
}

.page.scale-in {
  transform: scale(1);
  opacity: 1;
}

.page.zooming {
  transform: scale(1.12);
  opacity: 0;
  transition: transform .7s ease, opacity .7s ease;
  pointer-events: none;
}

.page h2 {
  font-size: 2rem;
  margin-bottom: 10px;
}
.page p {
  font-size: 1.1rem;
  color: var(--muted);
}

/* Logo sizing + entrance animation */
.logo {
  display: block;
  margin: 0 auto 18px;
  width: 48%;
  max-width: 420px;
  height: auto;
  opacity: 0;
  transform: translateY(12px) scale(1.03);
  transition: transform .7s cubic-bezier(.2,.9,.25,1), opacity .45s ease;
}

/* when page finishes scaling in, the logo animates into place */
.page.scale-in .logo {
  opacity: 1;
  transform: translateY(0) scale(1);
}

/* also allow toggling via a dedicated class for timing control */
.page.logo-in .logo {
  opacity: 1;
  transform: translateY(0) scale(1);
}
@media (max-width: calc(var(--mobile) - 1px)) {
  .page.logo-in .logo { transform: translateY(0) scale(0.88); }
}

/* On narrow screens, reduce logo so it visually matches splash zoom */
@media (max-width: calc(var(--mobile) - 1px)) {
  .logo {
    width: 60%;
    max-width: 320px;
  }
  /* mobile final scale during page reveal to visually match splash */
  .page.scale-in .logo {
    transform: translateY(0) scale(0.88);
  }
}

/* on tablet and up, slightly smaller logo to keep layout balanced */
@media (min-width: var(--mobile)) and (max-width: calc(var(--tablet) - 1px)) {
  .logo { width: 44%; max-width: 360px; }
}
@media (min-width: var(--tablet)) {
  .logo { width: 36%; max-width: 420px; }
}

/* ========================= */
/* BOUTON RETOUR AU MENU     */
/* ========================= */
.back-btn {
  margin: 20px auto 0; /* center horizontally */
  display: block;
  padding: 10px 24px;
  background: var(--accent);
  color: #000;
  font-weight: bold;
  border-radius: 8px;
  cursor: pointer;
  border: 1px solid var(--border);
  transition: transform .2s ease, background .2s ease;
}
.back-btn:hover {
  background: var(--accent-hover);
  transform: translateY(-2px) scale(1.05);
}
</style>
</head>

<body>

<!-- ========================= -->
<!-- BOUTONS LANGUE            -->
<!-- ========================= -->
<div class="lang-switch">
  <button class="lang-btn" id="btn-fr">FR</button>
  <button class="lang-btn" id="btn-en">EN</button>
</div>

<!-- ========================= -->
<!-- SPLASH SCREEN             -->
<!-- ========================= -->
<div id="splash">
  <h1>Bienvenue</h1>
  <p>Chargement...</p>

  <div class="enter-sides">
    <button id="enter-left" class="enter-side" aria-label="Entrer - main gauche" title="Entrer ‚Äî Main gauche"><span class="enter-label">Appuyer pour entrer</span></button>
    <button id="enter-right" class="enter-side" aria-label="Entrer - main droite" title="Entrer ‚Äî Main droite"><span class="enter-label">Appuyer pour entrer</span></button>
  </div>

  <div id="press-progress-bar" aria-hidden="true">
    <div id="press-progress-fill"></div>
    <div id="press-progress-text">0%</div>
  </div>
</div>

<!-- ========================= -->
<!-- ECRAN INTERMEDIAIRE       -->
<!-- ========================= -->
<div id="menu">
  <div class="menu-title" id="menu-title">Choose a category</div>
  <div class="menu-subtitle" id="menu-subtitle">S√©lectionnez une cat√©gorie</div>

  <button class="menu-btn" data-target="page1">üåø Comfort & Well‚ÄëBeing at Home</button>
  <button class="menu-btn" data-target="page2">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Connect Me to My Circle</button>
  <button class="menu-btn" data-target="page3">üåå Connect Me to New Realities</button>
</div>

<button id="global-control" class="enter-side global" aria-hidden="true"><span class="enter-label">Appuyer pour entrer</span></button>
<button id="global-back" class="enter-side global back" aria-hidden="true"><span class="enter-label">Retour</span></button>

<!-- ========================= -->
<!-- PAGE 1 (TON ANCIEN MAIN)  -->
<!-- ========================= -->
<div id="page1" class="page">
  <h2>üåø Comfort & Well‚ÄëBeing at Home</h2>

  <!-- üî• INS√àRE ICI TON ANCIEN MAIN COMPLET üî• -->
  <!-- Exemple : -->
  
  
  
  
  
  <main>
    <img src="connectmeifucan-logo-Noel.jpg" alt="Connect Me If U Can Logo" class="logo">

    <h3>üéÆ Connect Me If U Can (under construction)</h3>

    <div id="fr" class="lang">
      ‚ú® 1. D√©place-toi sereinement la nuit, en toute simplicit√©.<br>
      ‚ú® 2. Transforme ton salon en exp√©rience immersive √† domicile :<br>
      üî¶ Lumi√®res ‚Ä¢ Sons ‚Ä¢ Objets connect√©s.<br>
      ‚è≥ Voyage dans le temps entre 1850 et 2050.<br><br>

      <a class="cta" href="https://linktr.ee/connectmeifucan" target="_blank" rel="noopener">D√©couvrir</a>
      <div class="note">üí° Projects personnels en cours de d√©veloppement</div>
    </div>

    <div id="en" class="lang">
      ‚ú® 1. Move around at night with ease and peace of mind<br>
      ‚ú® 2. Turn your living room into an immersive home experience.<br>
      üî¶ Lights ‚Ä¢ Sounds ‚Ä¢ Smart objects.<br>
      ‚è≥ Time travel between 1850 and 2050.<br><br>

      <a class="cta" href="https://linktr.ee/connectmeifucan" target="_blank" rel="noopener">Discover</a>
      <div class="note">üí° Personal projects under development</div>
    </div>
  </main>






  </main>

  <button class="back-btn" data-back>‚¨Ö Retour au menu</button>
</div>

<!-- ========================= -->
<!-- PAGE 2                    -->
<!-- ========================= -->
<div id="page2" class="page">
  <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Connect Me to My Circle</h2>
  <p>Contenu √† venir‚Ä¶</p>
  <button class="back-btn" data-back>‚¨Ö Retour au menu</button>
</div>

<!-- ========================= -->
<!-- PAGE 3                    -->
<!-- ========================= -->
<div id="page3" class="page">
  <h2>üåå Connect Me to New Realities</h2>
  <p>Contenu √† venir‚Ä¶</p>
  <button class="back-btn" data-back>‚¨Ö Retour au menu</button>
</div>

<!-- ========================= -->
<!-- SCRIPT GLOBAL             -->
<!-- ========================= -->
<script>
/* SPLASH ‚Üí MENU (long-press left/right with progress + auto-enter fallback) */
console.debug('Splash script loaded');
window.addEventListener('error', (e) => { console.error('Global error:', e.error || e.message); });
const splash = document.getElementById("splash");
const menu = document.getElementById("menu");

const btnLeft = document.getElementById('enter-left');
const btnRight = document.getElementById('enter-right');
const progressBar = document.getElementById('press-progress-bar');
const progressFill = document.getElementById('press-progress-fill');
const progressText = document.getElementById('press-progress-text');

const PRESS_MS = 2000; // ms required to reach 100%
let pressRaf = null;
let pressStart = 0;
let currentHand = null;
// Auto-enter fallback is disabled. Keep the original behavior commented out for reference.
let autoEnterTimer = null;
/*
autoEnterTimer = setTimeout(() => {
  if (splash && !splash.classList.contains('zooming')) {
    // fallback: auto-complete after 3s
    doComplete('auto');
  }
}, 3000);
*/

function updateProgressUI(percent) {
  if (progressFill) progressFill.style.width = percent + '%';
  const lang = document.body.dataset.lang || document.documentElement.lang || 'fr';
  const prefix = lang === 'fr' ? 'Chargement ' : 'Loading ';
  if (progressText) progressText.textContent = prefix + Math.round(percent) + '%';
} 

function resetProgress() {
  console.debug('resetProgress');
  if (pressRaf) { cancelAnimationFrame(pressRaf); pressRaf = null; }
  if (progressBar) progressBar.classList.remove('visible');
  updateProgressUI(0);
  currentHand = null;
}

function startPress(hand) {
  clearTimeout(autoEnterTimer);
  if (!progressBar || !progressFill) return;
  currentHand = hand;
  progressBar.classList.add('visible');
  pressStart = performance.now();

  function step(t) {
    const elapsed = t - pressStart;
    const p = Math.min(1, elapsed / PRESS_MS);
    updateProgressUI(p * 100);
    // Use rounded percent to ensure displayed "100%" triggers the action
    if (Math.round(p * 100) >= 100) {
      if (pressRaf) { cancelAnimationFrame(pressRaf); pressRaf = null; }
      // Completed: record hand and start zoom transition
      doComplete(hand);
    } else {
      pressRaf = requestAnimationFrame(step);
    }
  }

  pressRaf = requestAnimationFrame(step);
}

function doComplete(hand) {
  console.debug('doComplete', hand);
  // clear fallback timer
  clearTimeout(autoEnterTimer);

  // Store detected hand and show global control
  if (hand && hand !== 'auto') showGlobalControl(hand);

  // start zoom-out on splash
  if (splash) splash.classList.add('zooming');

  // after transition, remove splash and show menu with scale-in
  setTimeout(() => {
    if (splash && splash.parentNode) splash.remove();
    if (menu) {
      menu.classList.add('active', 'scale-in');
      // initialize menu selection
      menuSelectedIndex = 0;
      highlightMenuSelection(menuSelectedIndex);
      // menu is active: update global control label to long-press text
      updateGlobalLabel();
    }

    // If a stored hand was deferred during splash, apply it now to show the persistent control
    if (window._deferredHand && !(document.body.classList.contains('hand-left') || document.body.classList.contains('hand-right'))) {
      console.debug('Applying deferred stored hand after splash:', window._deferredHand);
      showGlobalControl(window._deferredHand);
      delete window._deferredHand;
    }

    resetProgress();
  }, 700);
} 

// attach pointer handlers to left/right buttons (works for mouse & touch)
[btnLeft, btnRight].forEach(btn => {
  if (!btn) return;
  const hand = btn.id === 'enter-left' ? 'left' : 'right';

  // per-button RAF and timers to avoid interference between buttons
  btn._pressRaf = null;
  btn._pressStart = 0;

  function localStartPress() {
    console.debug('localStartPress', hand);
    clearTimeout(autoEnterTimer);
    if (!progressBar || !progressFill) { console.warn('Progress elements missing', {progressBar, progressFill}); return; }
    currentHand = hand;
    progressBar.classList.add('visible');
    btn._pressStart = performance.now();

    function step(t) {
      const elapsed = t - btn._pressStart;
      const p = Math.min(1, elapsed / PRESS_MS);
      updateProgressUI(p * 100);
      if (Math.round(p * 100) >= 100) {
        if (btn._pressRaf) { cancelAnimationFrame(btn._pressRaf); btn._pressRaf = null; }
        // Completed: record hand and start zoom transition
        console.debug('localStartPress completed', hand);
        doComplete(hand);
      } else {
        btn._pressRaf = requestAnimationFrame(step);
      }
    }

    btn._pressRaf = requestAnimationFrame(step);
  }

  function localReset() {
    if (btn._pressRaf) { cancelAnimationFrame(btn._pressRaf); btn._pressRaf = null; }
    progressBar.classList.remove('visible');
    updateProgressUI(0);
    currentHand = null;
  }

  btn.addEventListener('pointerdown', e => {
    console.debug('pointerdown', btn.id, e.pointerId);
    e.preventDefault();
    try { btn.setPointerCapture && btn.setPointerCapture(e.pointerId); } catch (err) { console.warn('setPointerCapture failed', err); }
    btn.classList.add('pressing');
    localStartPress();
  });

  btn.addEventListener('pointerup', e => {
    console.debug('pointerup', btn.id, e.pointerId);
    try { btn.releasePointerCapture && btn.releasePointerCapture(e.pointerId); } catch (err) { console.warn('releasePointerCapture failed', err); }
    btn.classList.remove('pressing');
    // if not completed yet, cancel
    if (btn._pressRaf) localReset();
  });

  btn.addEventListener('pointercancel', e => { console.debug('pointercancel', btn.id); btn.classList.remove('pressing'); localReset(); });
  btn.addEventListener('pointerleave', e => { if (btn._pressRaf) localReset(); btn.classList.remove('pressing'); });

  // keyboard support
  btn.addEventListener('keydown', e => {
    if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); btn.classList.add('pressing'); localStartPress(); }
  });
  btn.addEventListener('keyup', e => {
    if (e.key === ' ' || e.key === 'Enter') { btn.classList.remove('pressing'); if (btn._pressRaf) localReset(); }
  });
});

// -------------------------
// GLOBAL CONTROL & MENU NAV
// -------------------------
const globalControl = document.getElementById('global-control');
let globalPressRaf = null;
let globalPressStart = 0;
const TAP_THRESHOLD = 300; // ms for tap vs long-press
let menuButtons = Array.from(document.querySelectorAll('#menu .menu-btn[data-target]'));
let menuSelectedIndex = 0;

function updateGlobalLabel() {
  if (!globalControl) return;
  const lang = document.body.dataset.lang || document.documentElement.lang || 'fr';
  // on menu -> long-press message; otherwise short press hint
  const isMenu = menu && menu.classList.contains('active');
  const label = (lang === 'fr')
    ? (isMenu ? 'Appui long pour entrer' : 'Appuyer pour entrer')
    : (isMenu ? 'Long press to enter' : 'Press to enter');
  const lbl = globalControl.querySelector('.enter-label'); if (lbl) lbl.textContent = label;
}

function showGlobalControl(hand) {
  if (!globalControl) return;
  document.body.dataset.hand = hand;
  localStorage.setItem('cmuc_hand', hand);
  document.body.classList.remove('hand-left','hand-right');
  document.body.classList.add('hand-' + hand);
  globalControl.style.display = 'inline-flex';
  globalControl.classList.add('show');
  globalControl.setAttribute('aria-hidden', 'false');
  // set correct label for current state
  updateGlobalLabel();
}

function initGlobalFromStorage() {
  const hand = localStorage.getItem('cmuc_hand');
  if (hand === 'left' || hand === 'right') {
    // If the splash is still present, don't hide the opposite enter button yet.
    // Defer showing the persistent global control until after the splash transition.
    if (splash && !splash.classList.contains('zooming')) {
      console.debug('initGlobalFromStorage: deferring stored hand until after splash', hand);
      window._deferredHand = hand;
    } else {
      showGlobalControl(hand);
    }
  }
}

function highlightMenuSelection(i) {
  menuButtons = Array.from(document.querySelectorAll('#menu .menu-btn[data-target]'));
  if (!menuButtons.length) return;
  menuButtons.forEach((b, idx) => b.classList.toggle('selected', idx === i));
  // ensure it is in view
  try { menuButtons[i].scrollIntoView({ behavior: 'smooth', block: 'center' }); } catch (e) {}
}

function advanceMenuSelection() {
  if (!menu.classList.contains('active')) return;
  menuButtons = Array.from(document.querySelectorAll('#menu .menu-btn[data-target]'));
  if (!menuButtons.length) return;
  menuSelectedIndex = (menuSelectedIndex + 1) % menuButtons.length;
  highlightMenuSelection(menuSelectedIndex);
}

function confirmMenuSelection() {
  if (!menu || !menu.classList.contains('active')) { console.debug('confirmMenuSelection: menu not active or missing'); return; }
  menuButtons = Array.from(document.querySelectorAll('#menu .menu-btn[data-target]'));
  if (!menuButtons.length) { console.debug('confirmMenuSelection: no menu buttons found'); return; }
  const btn = menuButtons[menuSelectedIndex];
  console.debug('confirmMenuSelection', { menuSelectedIndex, btnId: btn && btn.id, target: btn && btn.dataset && btn.dataset.target });
  if (btn) {
    try {
      btn.click();
    } catch (err) {
      console.warn('confirmMenuSelection: btn.click() threw', err);
    }

    // Fallback: if click didn't navigate (no page became active), use navigateToPage
    const pageActive = !!document.querySelector('.page.active');
    const target = btn.dataset.target;
    if (!pageActive && target) {
      console.debug('confirmMenuSelection fallback navigation to', target);
      navigateToPage(target);
      menuSelectedIndex = 0; highlightMenuSelection(menuSelectedIndex);
    }
  }
}

function startGlobalPress() {
  console.debug('startGlobalPress');
  if (!progressBar) { console.warn('startGlobalPress: missing progressBar'); return; }
  globalPressStart = performance.now();
  progressBar.classList.add('visible');

  function step(t) {
    const elapsed = t - globalPressStart;
    const p = Math.min(1, elapsed / PRESS_MS);
    updateProgressUI(p * 100);
    // Use rounded percent so visible 100% reliably confirms selection
    if (Math.round(p * 100) >= 100) {
      if (globalPressRaf) { cancelAnimationFrame(globalPressRaf); globalPressRaf = null; }
      console.debug('startGlobalPress completed');
      confirmMenuSelection();
      resetGlobalProgress();
    } else {
      globalPressRaf = requestAnimationFrame(step);
    }
  }

  globalPressRaf = requestAnimationFrame(step);
}

function resetGlobalProgress() {
  if (globalPressRaf) { cancelAnimationFrame(globalPressRaf); globalPressRaf = null; }
  if (progressBar) progressBar.classList.remove('visible');
  updateProgressUI(0);
}

if (globalControl) {
  globalControl.addEventListener('pointerdown', e => {
    console.debug('global pointerdown');
    e.preventDefault();
    try { globalControl.setPointerCapture && globalControl.setPointerCapture(e.pointerId); } catch (err) { console.warn('global setPointerCapture failed', err); }
    globalControl.classList.add('pressing');
    startGlobalPress();
  });

  globalControl.addEventListener('pointerup', e => {
    console.debug('global pointerup');
    try { globalControl.releasePointerCapture && globalControl.releasePointerCapture(e.pointerId); } catch (err) { console.warn('global releasePointerCapture failed', err); }
    globalControl.classList.remove('pressing');
    const elapsed = performance.now() - globalPressStart;
    if (globalPressRaf) {
      // not completed: determine tap vs short press
      if (elapsed < TAP_THRESHOLD) {
        resetGlobalProgress();
        advanceMenuSelection();
      } else {
        resetGlobalProgress();
      }
    }
  });

  globalControl.addEventListener('pointercancel', e => { console.debug('global pointercancel'); globalControl.classList.remove('pressing'); resetGlobalProgress(); });
  globalControl.addEventListener('pointerleave', e => { if (globalPressRaf) resetGlobalProgress(); globalControl.classList.remove('pressing'); });

  globalControl.addEventListener('keydown', e => {
    if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); globalControl.classList.add('pressing'); startGlobalPress(); }
  });
  globalControl.addEventListener('keyup', e => {
    if (e.key === ' ' || e.key === 'Enter') {
      globalControl.classList.remove('pressing');
      if (globalPressRaf) {
        const elapsed = performance.now() - globalPressStart;
        if (elapsed < TAP_THRESHOLD) { resetGlobalProgress(); advanceMenuSelection(); } else { resetGlobalProgress(); }
      }
    }
  });
}

// initialize persistent control if user already chose a hand
initGlobalFromStorage();

// Global back control (opposite side)
const globalBack = document.getElementById('global-back');

function updateGlobalBackLabel() {
  if (!globalBack) return;
  const lang = document.body.dataset.lang || document.documentElement.lang || 'fr';
  const label = lang === 'fr' ? 'Retour' : 'Back';
  const lbl = globalBack.querySelector('.enter-label'); if (lbl) lbl.textContent = label;
}

function updateGlobalVisibility() {
  // show back control only when a page is active (not menu)
  const pageActive = !!document.querySelector('.page.active');
  if (globalBack) {
    if (pageActive) { globalBack.style.display = 'inline-flex'; globalBack.classList.add('show'); globalBack.setAttribute('aria-hidden', 'false'); }
    else { globalBack.style.display = 'none'; globalBack.classList.remove('show'); globalBack.setAttribute('aria-hidden', 'true'); }
  }
  // update labels
  updateGlobalLabel();
  updateGlobalBackLabel();
}

function goBackToMenu() {
  const activePage = document.querySelector('.page.active');
  if (activePage) {
    // animate page out with a subtle zoom & fade
    activePage.classList.add('zooming');
    // remove logo animation immediately so it scales with the page zoom
    activePage.classList.remove('logo-in');
    setTimeout(() => {
      activePage.classList.remove('active','scale-in','frame','zooming');
      menu.classList.add('active');
      menuSelectedIndex = 0; highlightMenuSelection(menuSelectedIndex);
      updateGlobalVisibility();
    }, 700);
  } else {
    // fallback immediate show menu
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active','scale-in','frame','zooming','logo-in'));
    setTimeout(() => {
      menu.classList.add('active');
      menuSelectedIndex = 0; highlightMenuSelection(menuSelectedIndex);
      updateGlobalVisibility();
    }, 20);
  }
}

if (globalBack) {
  globalBack.addEventListener('click', e => { e.preventDefault(); goBackToMenu(); });
}

// Ensure visibility is updated when navigating to a page
function navigateToPage(target) {
  const page = document.getElementById(target);
  if (!page) return;
  // hide menu and clear selection
  menu.classList.remove('active');
  document.querySelectorAll('#menu .menu-btn').forEach(b => b.classList.remove('selected'));
  // remove classes from other pages
  document.querySelectorAll('.page').forEach(p => { if (p !== page) { p.classList.remove('active','scale-in','frame','zooming'); } });
  // prepare and show page
  page.classList.add('frame');
  page.classList.add('active');
  setTimeout(() => {
    page.classList.add('scale-in');
    // add 'logo-in' as a separate hook for fine-grained animation (small delay)
    setTimeout(() => page.classList.add('logo-in'), 30);
    // update back control visibility when on page
    updateGlobalVisibility();
  }, 20);
}

// Attach handlers that use navigateToPage
document.querySelectorAll(".menu-btn[data-target]").forEach(btn => {
  btn.addEventListener("click", () => {
    const target = btn.dataset.target;
    console.debug('menu button clicked', { id: btn.id, target });
    navigateToPage(target);
  });
});

// update visibility when returning to menu via back buttons
document.querySelectorAll("[data-back]").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));

    setTimeout(() => {
      menu.classList.add("active");
      // reset & highlight first option
      menuSelectedIndex = 0;
      highlightMenuSelection(menuSelectedIndex);
      // update global label to long-press when returning to menu
      updateGlobalLabel();
      // update visibility
      updateGlobalVisibility();
    }, 20);
  });
});

/* CATEGORIES ‚Üí PAGES */
document.querySelectorAll(".menu-btn[data-target]").forEach(btn => {
  btn.addEventListener("click", () => {
    const target = btn.dataset.target;
    console.debug('menu button clicked (categories)', { id: btn.id, target });
    navigateToPage(target);
  });
});

/* BOUTON RETOUR AU MENU */
document.querySelectorAll("[data-back]").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));

    setTimeout(() => {
      menu.classList.add("active");
      // reset & highlight first option
      menuSelectedIndex = 0;
      highlightMenuSelection(menuSelectedIndex);
      // update global label to long-press when returning to menu
      updateGlobalLabel();
    }, 20);
  });
}); 

/* LANGUE FR / EN */
const btnFR = document.getElementById("btn-fr");
const btnEN = document.getElementById("btn-en");

const menuTitle = document.getElementById("menu-title");
const menuSubtitle = document.getElementById("menu-subtitle");

function setFR() {
  document.body.dataset.lang = 'fr';
  menuTitle.textContent = "Choisissez une cat√©gorie";
  menuSubtitle.textContent = "S√©lectionnez une cat√©gorie";

  // splash texts (FR)
  const splashH1 = document.querySelector('#splash h1');
  const splashP = document.querySelector('#splash p');
  if (splashH1) splashH1.textContent = "Bienvenue";
  if (splashP) splashP.textContent = "Chargement...";
  const leftBtn = document.getElementById('enter-left');
  const rightBtn = document.getElementById('enter-right');
  if (leftBtn) leftBtn.title = "Entrer ‚Äî Main gauche";
  if (rightBtn) rightBtn.title = "Entrer ‚Äî Main droite";
  // enter labels (update; final label may change when in menu)
  document.querySelectorAll('.enter-label').forEach(el => el.textContent = 'Appuyer pour entrer');
  const progressTextElFr = document.getElementById('press-progress-text');
  if (progressTextElFr) progressTextElFr.textContent = 'Chargement 0%';
  // if global control exists and menu already active, set the menu-specific text
  if (globalControl && menu && menu.classList.contains('active')) updateGlobalLabel();

  document.querySelector('[data-target="page1"]').textContent =
    "üåø Confort & Bien‚Äë√ätre at Home";
  document.querySelector('[data-target="page2"]').textContent =
    "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Connecte‚ÄëMoi √† Mon Cercle";
  document.querySelector('[data-target="page3"]').textContent =
    "üåå Connecte‚ÄëMoi aux Nouvelles R√©alit√©s";

  document.querySelector("#page1 h2").textContent =
    "üåø Confort & Bien‚Äë√ätre at Home";
  document.querySelector("#page2 h2").textContent =
    "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Connecte‚ÄëMoi √† Mon Cercle";
  document.querySelector("#page3 h2").textContent =
    "üåå Connecte‚ÄëMoi aux Nouvelles R√©alit√©s";
  document.querySelectorAll("[data-back]").forEach(btn => { btn.textContent = "‚¨Ö Retour au menu"; });
  // update global control/back labels and visibility
  updateGlobalLabel();
  updateGlobalBackLabel();
  updateGlobalVisibility();
}

function setEN() {
  document.body.dataset.lang = 'en';
  menuTitle.textContent = "Choose a category";
  menuSubtitle.textContent = "Select a category";

  // splash texts (EN)
  const splashH1En = document.querySelector('#splash h1');
  const splashPEn = document.querySelector('#splash p');
  if (splashH1En) splashH1En.textContent = "Welcome";
  if (splashPEn) splashPEn.textContent = "Loading...";
  const leftBtnEn = document.getElementById('enter-left');
  const rightBtnEn = document.getElementById('enter-right');
  if (leftBtnEn) leftBtnEn.title = "Enter ‚Äî Left hand";
  if (rightBtnEn) rightBtnEn.title = "Enter ‚Äî Right hand";
  // enter labels (update; final label may change when in menu)
  document.querySelectorAll('.enter-label').forEach(el => el.textContent = 'Press to enter');
  const progressTextElEn = document.getElementById('press-progress-text');
  if (progressTextElEn) progressTextElEn.textContent = 'Loading 0%';
  // if global control exists and menu already active, set the menu-specific text
  if (globalControl && menu && menu.classList.contains('active')) updateGlobalLabel();

  document.querySelector('[data-target="page1"]').textContent =
    "Comfort & Well‚ÄëBeing at Home";
  document.querySelector('[data-target="page2"]').textContent =
    "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Connect Me to My Circle";
  document.querySelector('[data-target="page3"]').textContent =
    "üåå Connect Me to New Realities";

  document.querySelector("#page1 h2").textContent =
    "üåø Comfort & Well‚ÄëBeing at Home";
  document.querySelector("#page2 h2").textContent =
    "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Connect Me to My Circle";
  document.querySelector("#page3 h2").textContent =
    "üåå Connect Me to New Realities";
  document.querySelectorAll("[data-back]").forEach(btn => { btn.textContent = "‚¨Ö Back to menu"; });
  // update global control/back labels and visibility
  updateGlobalLabel();
  updateGlobalBackLabel();
  updateGlobalVisibility();
}

btnFR.addEventListener("click", setFR);
btnEN.addEventListener("click", setEN);
</script>

</body>
</html> 
