<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WTP Study ‚Äì SmartPlug (GEM)</title>
  <style>
    :root{--bg:#f7f7f7;--text:#111827;--muted:#6b7280;--brand:#009E4F;--card:#fff;--shadow:0 10px 30px rgba(0,0,0,.06);--radius:18px}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial;background:var(--bg);color:var(--text)}
    header{background:#fff;box-shadow:var(--shadow);position:sticky;top:0;z-index:10}
    .head{max-width:980px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;gap:12px}
    .gem{height:36px}
    .brand{margin-left:auto;display:flex;align-items:center;gap:10px;white-space:nowrap}
    .dot{width:10px;height:10px;background:var(--brand);border-radius:50%}
    .container{max-width:980px;margin:28px auto;padding:0 20px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px}
    h1{margin:.2em 0 .4em 0;font-size:clamp(22px,4vw,34px)}
    h2{font-size:18px;margin:0 0 6px 0}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    .section{padding:18px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px}
    .bullet{margin:.2em 0}
    .price{font-size:22px;font-weight:800}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .value{font-variant-numeric:tabular-nums;font-weight:800}
    input[type=range]{width:100%}
    .btn{appearance:none;border:0;border-radius:12px;padding:13px 18px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn-primary{background:var(--brand);color:#fff}
    .hint{font-size:12px;color:#6b7280}
    .ok{color:#059669}.err{color:#b91c1c}
    .lang{font-size:12px;color:#6b7280;margin-left:8px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="head">
      <img class="gem" src="logo_GEM.png" alt="GEM ‚Äì Grenoble √âcole de Management" />
      <div class="brand"><div class="dot"></div><strong id="brandTitle">WTP Study ‚Äì SmartPlug</strong><span id="langNote" class="lang"></span></div>
    </div>
  </header>

  <div class="container">
    <div class="card">
      <h1 id="title">√âtude rapide sur la disposition √† payer (WTP)</h1>
      <p class="muted" id="intro">
        <strong>Produit affich√© :</strong> 49 ‚Ç¨ TTC.<br/>
        Dans le cadre d‚Äôune √©tude rapide sur la disposition √† payer (WTP) et les comportements d‚Äôachat,
        merci d‚Äôindiquer votre prix pour la <strong>version en plastique recycl√© (80 %)</strong> conservant les m√™mes fonctionnalit√©s.
      </p>

      <div class="grid" style="margin-top:12px">
        <div class="section">
          <h2 id="stdTitle">Produit standard</h2>
          <p class="bullet" id="stdMat">Mat√©riau : <strong>Plastique conventionnel</strong> (non recycl√©)</p>
          <p class="price" id="stdPrice">Prix affich√© : <strong>49 ‚Ç¨ TTC</strong></p>
        </div>
        <div class="section">
          <h2 id="ecoTitle">Alternative durable</h2>
          <p class="bullet" id="ecoMat">Mat√©riau : <strong>Plastique r√©utilisable</strong> √† caract√©ristiques √©quivalentes</p>
          <p class="bullet" id="ecoFeat">Fonctionnalit√©s : <strong>identiques</strong> au produit standard</p>
        </div>
      </div>

      <div class="section" style="margin-top:16px">
        <h2 id="qTitle">üß† Question</h2>
        <p class="bullet" id="qText">Quel prix seriez-vous pr√™t(e) √† payer pour la version en plastique r√©utilisable, tout en conservant les m√™mes fonctionnalit√©s ?</p>
        <div class="row" style="justify-content:space-between;margin-top:6px">
          <span class="muted" id="lowLab">Plus bas</span><strong class="value" id="wtpValue">49 ‚Ç¨</strong><span class="muted" id="highLab">Plus √©lev√©</span>
        </div>
        <input type="range" min="29" max="69" step="1" value="49" id="wtp" />
        <p class="hint" id="sliderHint">Curseur ¬±20 ‚Ç¨ autour de 49 ‚Ç¨ (29‚Äì69 ‚Ç¨).</p>

        <div class="row" style="margin-top:10px">
          <label for="email" class="muted" id="emailLab">Email (facultatif) :</label>
          <input id="email" type="email" placeholder="prenom.nom@exemple.com" style="flex:1;min-width:240px;padding:12px;border:1px solid #d1d5db;border-radius:10px"/>
        </div>

        <div class="row" style="margin-top:12px">
          <button class="btn btn-primary" id="submit">Valider</button>
          <span id="status" class="hint"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // === CONFIGUREZ votre endpoint Apps Script ici ===================
    // Exemple : const ENDPOINT_URL = "https://script.google.com/macros/s/XXXXX/exec";
    const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbw22NylHzIQ31q2U1EKVJZ5mx_4UQwlJFI54E9cAzguz5jKMi4DTtlMtfIx2zSQ7eSBTg/exec";
    // ================================================================

    // i18n texts
    const texts = {
      fr: {
        brandTitle: "√âtude WTP ‚Äì SmartPlug",
        langNote: "(langue d√©tect√©e : fran√ßais)",
        title: "√âtude rapide sur la disposition √† payer (WTP)",
        intro_html: "<strong>Produit affich√© :</strong> 49 ‚Ç¨ TTC.<br/>Dans le cadre d‚Äôune √©tude rapide sur la disposition √† payer (WTP) et les comportements d‚Äôachat, merci d‚Äôindiquer votre prix pour la <strong>version en plastique recycl√© (80 %)</strong> conservant les m√™mes fonctionnalit√©s.",
        stdTitle: "Produit standard",
        stdMat: "Mat√©riau : <strong>Plastique conventionnel</strong> (non recycl√©)",
        stdPrice: "Prix affich√© : <strong>49 ‚Ç¨ TTC</strong>",
        ecoTitle: "Alternative durable",
        ecoMat: "Mat√©riau : <strong>Plastique r√©utilisable</strong> √† caract√©ristiques √©quivalentes",
        ecoFeat: "Fonctionnalit√©s : <strong>identiques</strong> au produit standard",
        qTitle: "üß† Question",
        qText: "Quel prix seriez-vous pr√™t(e) √† payer pour la version en plastique r√©utilisable, tout en conservant les m√™mes fonctionnalit√©s ?",
        lowLab: "Plus bas",
        highLab: "Plus √©lev√©",
        sliderHint: "Curseur ¬±20 ‚Ç¨ autour de 49 ‚Ç¨ (29‚Äì69 ‚Ç¨).",
        emailLab: "Email (facultatif) :",
        submit: "Valider",
        currency: "EUR",
        fmt: (v)=> new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'}).format(Number(v))
      },
      en: {
        brandTitle: "WTP Study ‚Äì SmartPlug",
        langNote: "(browser language detected: English)",
        title: "Quick Willingness-To-Pay (WTP) Study",
        intro_html: "<strong>Displayed product:</strong> ‚Ç¨49 incl. VAT.<br/>For a quick WTP study on purchasing behavior, please indicate your price for the <strong>recycled plastic version (80%)</strong> with identical features.",
        stdTitle: "Standard product",
        stdMat: "Material: <strong>Conventional plastic</strong> (non‚Äërecycled)",
        stdPrice: "Displayed price: <strong>‚Ç¨49 incl. VAT</strong>",
        ecoTitle: "Sustainable alternative",
        ecoMat: "Material: <strong>Reusable plastic</strong> with equivalent characteristics",
        ecoFeat: "Features: <strong>identical</strong> to the standard product",
        qTitle: "üß† Question",
        qText: "What price would you be willing to pay for the reusable‚Äëplastic version while keeping the same features?",
        lowLab: "Lower",
        highLab: "Higher",
        sliderHint: "Slider ¬±‚Ç¨20 around ‚Ç¨49 (‚Ç¨29‚Äì‚Ç¨69).",
        emailLab: "Email (optional):",
        submit: "Submit",
        currency: "EUR",
        fmt: (v)=> new Intl.NumberFormat('en-GB',{style:'currency',currency:'EUR'}).format(Number(v))
      }
    };

    const isFr = (navigator.language || navigator.userLanguage || "en").toLowerCase().startsWith("fr");
    const t = isFr ? texts.fr : texts.en;
    document.documentElement.lang = isFr ? "fr" : "en";

    // Apply texts
    const $ = (id)=>document.getElementById(id);
    $("brandTitle").textContent = t.brandTitle;
    $("langNote").textContent = t.langNote;
    $("title").textContent = t.title;
    $("intro").innerHTML = t.intro_html;
    $("stdTitle").textContent = t.stdTitle;
    $("stdMat").innerHTML = t.stdMat;
    $("stdPrice").innerHTML = t.stdPrice;
    $("ecoTitle").textContent = t.ecoTitle;
    $("ecoMat").innerHTML = t.ecoMat;
    $("ecoFeat").innerHTML = t.ecoFeat;
    $("qTitle").textContent = t.qTitle;
    $("qText").textContent = t.qText;
    $("lowLab").textContent = t.lowLab;
    $("highLab").textContent = t.highLab;
    $("sliderHint").textContent = t.sliderHint;
    $("emailLab").textContent = t.emailLab;
    $("submit").textContent = t.submit;

    // Slider live value with locale currency
    const slider = document.getElementById('wtp');
    const out = document.getElementById('wtpValue');
    const update = ()=> out.textContent = t.fmt(slider.value);
    slider.addEventListener('input', update); update();

    // Silent submit: sendBeacon-first then fetch fallback WITHOUT headers (no preflight)
    const status = document.getElementById('status');
    document.getElementById('submit').addEventListener('click', async function(){
      const price = Number(slider.value);
      const email = (document.getElementById('email').value || "").trim() || null;
      const payload = {
        ts: new Date().toISOString(),
        product: isFr ? "SmartPlug ‚Äì version recycl√©e (WTP)" : "SmartPlug ‚Äì recycled version (WTP)",
        displayed_price_standard: 49,
        user_wtp_recycled: price,
        email_optional: email,
        utm: {}
      };
      try{
        status.textContent = isFr ? "Envoi‚Ä¶" : "Sending‚Ä¶";
        // 1) sendBeacon (text/plain) pour √©viter le pr√©flight
        const blob = new Blob([JSON.stringify(payload)], { type: "text/plain;charset=UTF-8" });
        let sent = false;
        try { sent = navigator.sendBeacon && navigator.sendBeacon(ENDPOINT_URL, blob); } catch(_) {}
        if (!sent) {
          // 2) fetch sans header Content-Type (√©vite preflight)
          const res = await fetch(ENDPOINT_URL, {
            method: "POST",
            body: JSON.stringify(payload),
            keepalive: true,
            mode: "cors"
          });
          if(!res.ok) throw new Error("HTTP " + res.status);
        }
        status.textContent = isFr ? "OK ‚úî" : "OK ‚úî";
        status.className = "hint ok";
        setTimeout(()=>{ window.location.href = "thank_you.html"; }, 250);
      }catch(e){
        status.textContent = (isFr ? "√âchec" : "Failed") + " ("+e.message+")";
        status.className = "hint err";
      }
    });
  </script>
</body>
</html>
