<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartPlug – WTP (soumission silencieuse)</title>
  <meta name="description" content="Étude WTP sur SmartPlug, prise connectée. Indiquez votre disposition à payer pour la version en plastique recyclé (80%).">
  <style>
    :root{--bg:#f7f7f7;--text:#111827;--muted:#6b7280;--brand:#009E4F;--card:#fff;--shadow:0 10px 30px rgba(0,0,0,.06);--radius:18px}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial;background:var(--bg);color:var(--text)}
    header{background:#fff;box-shadow:var(--shadow);position:sticky;top:0;z-index:10}
    .head{max-width:980px;margin:0 auto;padding:16px 20px;display:flex;align-items:center;gap:10px}
    .dot{width:12px;height:12px;background:var(--brand);border-radius:50%}
    .container{max-width:980px;margin:28px auto;padding:0 20px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:28px;align-items:center}
    h1{margin:.2em 0 .4em 0;font-size:clamp(24px,4vw,36px)}
    .muted{color:var(--muted)}
    .price{font-size:28px;font-weight:800;margin:.6em 0}
    .pill{display:inline-flex;gap:8px;align-items:center;background:#f1f5f9;color:#111;border-radius:999px;padding:6px 10px;font-size:12px;margin-right:6px}
    .section{margin-top:16px;padding:18px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .value{font-variant-numeric:tabular-nums;font-weight:800}
    input[type=range]{width:100%}
    .btn{appearance:none;border:0;border-radius:12px;padding:13px 18px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn-primary{background:var(--brand);color:#fff}
    .hint{font-size:12px;color:#6b7280}
    .ok{color:#059669}
    .err{color:#b91c1c}
    .product{background:linear-gradient(180deg,#fff,#f3f4f6);border-radius:16px;display:flex;align-items:center;justify-content:center;min-height:260px;padding:24px}
    .product img{max-width:100%;height:auto;border-radius:12px;display:block}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="head"><div class="dot"></div><strong>SmartPlug</strong><span class="muted"> – Étude WTP (soumission silencieuse)</span></div>
  </header>

  <div class="container">
    <div class="card grid">
      <!-- Colonne gauche : contenu -->
      <section>
        <h1>SmartPlug – Prise connectée</h1>
        <p class="muted">
          <strong>Produit affiché : 49 € TTC</strong>.<br/>
          Dans le cadre d’une étude rapide sur la <em>disposition à payer (WTP)</em> et les comportements d’achat, merci d’indiquer votre prix pour la <strong>version en plastique recyclé (80 %)</strong>.
        </p>

        <div class="price">Prix affiché (standard) : 49 € TTC</div>
        <div class="row" aria-label="Atouts produit">
          <span class="pill">Fiabilité</span>
          <span class="pill">Contrôle à distance</span>
          <span class="pill">Garantie 3 ans</span>
          <span class="pill">Plastique recyclé 80%</span>
        </div>

        <div class="section" aria-labelledby="wtp-label">
          <label id="wtp-label" for="wtp"><strong>Votre prix pour la version recyclée :</strong></label>
          <div class="row" style="justify-content:space-between">
            <span class="muted">Plus bas</span>
            <strong class="value" id="wtpValue">49 €</strong>
            <span class="muted">Plus élevé</span>
          </div>
          <input type="range" min="29" max="69" step="1" value="49" id="wtp" aria-describedby="wtp-hint"/>
          <div id="wtp-hint" class="hint">Curseur ±20 € autour de 49 € (29–69 €).</div>

          <div class="row" style="margin-top:10px">
            <label for="email" class="muted">Email (facultatif) :</label>
            <input id="email" type="email" inputmode="email" autocomplete="email" placeholder="prenom.nom@exemple.com" style="flex:1;min-width:240px;padding:12px;border:1px solid #d1d5db;border-radius:10px"/>
          </div>

          <div class="row" style="margin-top:12px">
            <button class="btn btn-primary" id="submit">Valider</button>
            <span id="status" class="hint" role="status" aria-live="polite"></span>
          </div>

          <p class="hint">Soumission silencieuse via <code>sendBeacon</code> (puis fallback <code>fetch</code>) vers un endpoint Google Apps Script.</p>
        </div>

        <p class="hint" id="utmDebug"></p>
      </section>

      <!-- Colonne droite : image IA -->
      <aside class="product">
        <!-- Place le fichier à côté de index.html sous le nom smartplug-ai.jpg -->
        <img src="Prise connectee.jpg" alt="Photo produit : prise connectée SmartPlug sur fond blanc, angle trois-quarts"/>
      </aside>
    </div>
  </div>

  <script>
    // === CONFIG (à personnaliser) ===================
    // Remplace par TON URL Apps Script /exec
    const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbwSj4QEcFCUofbJI3WY1AzrwFwCitb1lGErNlMB2u8upm5bMl5bvj7mCppSr0rwOt6Dog/exec";
    // =================================================

    // UTM capture (LinkedIn/Instagram)
    function getQueryParams(){ return new URLSearchParams(window.location.search); }
    const p = getQueryParams();
    const utm = {
      source: p.get('utm_source') || 'linkedin',
      medium: p.get('utm_medium') || 'cpc',
      campaign: p.get('utm_campaign') || 'ab-wtp',
      content: p.get('utm_content') || 'wtp-slider-silent'
    };
    document.getElementById('utmDebug').textContent = "UTM → " + JSON.stringify(utm);

    // Slider live value
    const slider = document.getElementById('wtp');
    const out = document.getElementById('wtpValue');
    const fmt = (v)=> new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'}).format(Number(v));
    const update = ()=> out.textContent = fmt(slider.value);
    slider.addEventListener('input', update); update();

    // Submit silencieux : sendBeacon puis fetch (sans Content-Type explicite)
    const status = document.getElementById('status');
    document.getElementById('submit').addEventListener('click', async function(){
      const price = Number(slider.value);
      const email = (document.getElementById('email').value || "").trim() || null;

      const payload = {
        ts: new Date().toISOString(),
        product: "SmartPlug – version recyclée (WTP)",
        displayed_price_standard: 49,
        user_wtp_recycled: price,
        email_optional: email,
        utm
      };

      try{
        status.textContent = "Envoi…";
        const blob = new Blob([JSON.stringify(payload)], { type: "text/plain;charset=UTF-8" });

        let sent = false;
        try { sent = navigator.sendBeacon && navigator.sendBeacon(ENDPOINT_URL, blob); } catch(_) {}

        if (!sent) {
          const res = await fetch(ENDPOINT_URL, {
            method: "POST",
            body: JSON.stringify(payload),
            keepalive: true,
            mode: "cors"
          });
          if(!res.ok) throw new Error("HTTP " + res.status);
        }

        status.textContent = "OK ✔"; status.className = "hint ok";
        setTimeout(()=>{ window.location.href = "thank_you.html"; }, 300);
      }catch(e){
        status.textContent = "Échec ("+e.message+")"; status.className = "hint err";
      }
    });
  </script>
</body>
</html>
